{
    "version": "2.0.0",
    "tasks": [
        {
            "label": ".‚ñ∂Ô∏è Init Workdir for Common Torizon",
            "command": "echo",
            "type": "shell",
            "args": [
                "OK ‚úÖ"
            ],
            "problemMatcher": [
                "$gcc"
            ],
            "icon": {
                "id": "flame",
                "color": "terminal.ansiYellow"
            },
            "dependsOrder": "sequence",
            "dependsOn": [
                "create-build-folder",
                "repo-init",
                "repo-sync",
                "config-vscode-bitbake"
            ]
        },
        {
            "label": "Build TorizonCore Labs (devcontainer)",
            "command": "echo",
            "type": "shell",
            "args": [
                "OK ‚úÖ"
            ],
            "problemMatcher": [
                "$gcc"
            ],
            "icon": {
                "id": "flame",
                "color": "terminal.ansiYellow"
            },
            "dependsOrder": "sequence",
            "dependsOn": [
                "build-container"
            ],
            "group": {
                "kind": "build",
                "isDefault": true
            }
        },
        {
            "label": "create-build-folder",
            "detail": "hide",
            "command": "mkdir",
            "type": "shell",
            "options": {
                "cwd": "/workdir"
            },
            "args": [
                "-p",
                "torizon"
            ],
            "problemMatcher": [
                "$gcc"
            ],
            "icon": {
                "id": "flame",
                "color": "terminal.ansiYellow"
            },
            "dependsOrder": "sequence",
            "dependsOn": [
            ]
        },
        {
            "label": "repo-init",
            "detail": "",
            "command": "repo",
            "type": "shell",
            "options": {
                "cwd": "/workdir/torizon"
            },
            "args": [
                "init",
                "--no-repo-verify",
                "-u",
                "${workspaceFolder}/",
                "-b",
                "kirkstone",
                "-m",
                "torizoncore/common.xml"
            ],
            "problemMatcher": [
                "$gcc"
            ],
            "icon": {
                "id": "flame",
                "color": "terminal.ansiYellow"
            },
            "dependsOrder": "sequence",
            "dependsOn": [
            ]
        },
        {
            "label": "repo-sync",
            "detail": "",
            "command": "repo",
            "type": "shell",
            "options": {
                "cwd": "/workdir/torizon"
            },
            "args": [
                "sync",
                "-j",
                "16"
            ],
            "problemMatcher": [
                "$gcc"
            ],
            "icon": {
                "id": "flame",
                "color": "terminal.ansiYellow"
            },
            "dependsOrder": "sequence",
            "dependsOn": [
            ]
        },
        {
            "label": "config-vscode-bitbake",
            "detail": "",
            "command": "pwsh",
            "type": "shell",
            "options": {
                "cwd": "/workdir/torizon/layers"
            },
            "args": [
                "-nop",
                "-f",
                "${workspaceFolder}/.scripts/configVscodeBitbake.ps1"
            ],
            "problemMatcher": [
                "$gcc"
            ],
            "icon": {
                "id": "flame",
                "color": "terminal.ansiYellow"
            },
            "dependsOrder": "sequence",
            "dependsOn": [
            ]
        },
        {
            "label": ".üìã Repo Init Sync",
            "detail": "",
            "command": "echo",
            "type": "shell",
            "options": {
                "cwd": "/workdir/torizon"
            },
            "args": [
                "DONE"
            ],
            "problemMatcher": [
                "$gcc"
            ],
            "icon": {
                "id": "flame",
                "color": "terminal.ansiYellow"
            },
            "dependsOrder": "sequence",
            "dependsOn": [
                "repo-init",
                "repo-sync"
            ]
        },
        {
            "label": "crops-build",
            "detail": "",
            "command": "docker",
            "type": "shell",
            "options": {
                "cwd": "${workspaceFolder}/../workdir/torizon"
            },
            "args": [
                "run",
                "--rm",
                "-it",
                "--name=labs-crops",
                "-v",
                "${workspaceFolder}/../workdir:/workdir",
                "--workdir=/workdir",
                "-e",
                "ACCEPT_FSL_EULA=1",
                "-e",
                "MACHINE=${config:machine}",
                "-e",
                "IMAGE=${config:image}",
                "matheuscastello/crops:kirkstone"
            ],
            "problemMatcher": [
                "$gcc"
            ],
            "icon": {
                "id": "flame",
                "color": "terminal.ansiYellow"
            },
            "dependsOrder": "sequence",
            "dependsOn": [
            ]
        },
        {
            "label": "build-container",
            "detail": "",
            "command": "${config:bitbake.setupScript}",
            "type": "shell",
            "options": {
                "cwd": "/workdir/torizon",
                "env": {
                    "ACCEPT_FSL_EULA": "1",
                    "MACHINE": "${config:machine}",
                    "IMAGE": "${config:image}",
                    "DISTRO": "${config:distro}"
                }
            },
            "args": [
                "${config:build_dir}",
                "&&",
                "echo",
                "'Yocto build for ${config:distro} ${config:image} ${config:machine} has been finished'",
                "|",
                "nc",
                "${config:notifyAddr}",
                "${config:notifyPort}"
            ],
            "problemMatcher": [
                "$gcc"
            ],
            "icon": {
                "id": "flame",
                "color": "terminal.ansiYellow"
            },
            "dependsOrder": "sequence",
            "dependsOn": [
            ]
        },
        {
            "label": ".üÜï Build",
            "detail": "",
            "command": "",
            "type": "shell",
            "args": [
            ],
            "problemMatcher": [
                "$gcc"
            ],
            "icon": {
                "id": "flame",
                "color": "terminal.ansiYellow"
            },
            "dependsOrder": "sequence",
            "dependsOn": [
                "build-container"
            ],
            "group": {
                "kind": "build",
                "isDefault": true
            }
        },
        {
            "label": ".üèóÔ∏è Clean & Build",
            "detail": "",
            "command": "",
            "type": "shell",
            "args": [
            ],
            "problemMatcher": [
                "$gcc"
            ],
            "icon": {
                "id": "flame",
                "color": "terminal.ansiYellow"
            },
            "dependsOrder": "sequence",
            "dependsOn": [
                "bitbake-clean-torizonCore-container",
                "build-container"
            ],
            "group": {
                "kind": "build",
                "isDefault": true
            }
        },
        {
            "label": ".üßπ Clean",
            "detail": "",
            "command": "",
            "type": "shell",
            "args": [
            ],
            "problemMatcher": [
                "$gcc"
            ],
            "icon": {
                "id": "flame",
                "color": "terminal.ansiYellow"
            },
            "dependsOrder": "sequence",
            "dependsOn": [
                "bitbake-clean-torizonCore-container"
            ]
        },
        {
            "label": ".üíæ Flash Image",
            "detail": "",
            "command": "sudo",
            "type": "shell",
            "options": {
                "cwd": "${workspaceFolder}/../workdir/torizon"
            },
            "args": [
                "bmaptool",
                "copy",
                "${workspaceFolder}/../workdir/torizon/build-${config:distro}/deploy/images/${config:machine}/${config:image}-${config:machine}.${config:image_format}",
                "/dev/sdb"
            ],
            "problemMatcher": [
                "$gcc"
            ],
            "icon": {
                "id": "flame",
                "color": "terminal.ansiYellow"
            },
            "dependsOrder": "sequence",
            "dependsOn": [
            ]
        },
        {
            "label": ".üíæ Flash Image --nobmap",
            "detail": "",
            "command": "sudo",
            "type": "shell",
            "options": {
                "cwd": "${workspaceFolder}/../workdir/torizon"
            },
            "args": [
                "bmaptool",
                "copy",
                "--nobmap",
                "${workspaceFolder}/../workdir/torizon/build-${config:distro}/deploy/images/${config:machine}/${config:image}-${config:machine}.${config:image_format}",
                "/dev/sdb"
            ],
            "problemMatcher": [
                "$gcc"
            ],
            "icon": {
                "id": "flame",
                "color": "terminal.ansiYellow"
            },
            "dependsOrder": "sequence",
            "dependsOn": [
            ]
        },
        {
            "label": ".üî¨ Variable Value",
            "detail": "",
            "command": "${config:bitbake.setupScript}",
            "type": "shell",
            "options": {
                "cwd": "/workdir/torizon",
                "env": {
                    "EULA": "1",
                    "ACCEPT_FSL_EULA": "1",
                    "MACHINE": "${config:machine}",
                    "IMAGE": "${config:image}",
                    "CMD": "bitbake -e ${config:image} | grep \"^${input:variableName}\""
                }
            },
            "args": [
            ],
            "problemMatcher": [
                "$gcc"
            ],
            "icon": {
                "id": "flame",
                "color": "terminal.ansiYellow"
            },
            "dependsOrder": "sequence",
            "dependsOn": [
            ]
        },
        {
            "label": ".üî¨ Recipe Variable Value",
            "detail": "",
            "command": "${config:bitbake.setupScript}",
            "type": "shell",
            "options": {
                "cwd": "/workdir/torizon",
                "env": {
                    "EULA": "1",
                    "ACCEPT_FSL_EULA": "1",
                    "MACHINE": "${config:machine}",
                    "IMAGE": "${config:image}",
                    "CMD": "bitbake -e ${input:recipeName} | grep \"^${input:variableName}\""
                }
            },
            "args": [
            ],
            "problemMatcher": [
                "$gcc"
            ],
            "icon": {
                "id": "flame",
                "color": "terminal.ansiYellow"
            },
            "dependsOrder": "sequence",
            "dependsOn": [
            ]
        },
        {
            "label": ".üìÉ List Recipes",
            "detail": "",
            "command": "${config:bitbake.setupScript}",
            "type": "shell",
            "options": {
                "cwd": "/workdir/torizon",
                "env": {
                    "EULA": "1",
                    "ACCEPT_FSL_EULA": "1",
                    "MACHINE": "${config:machine}",
                    "IMAGE": "${config:image}",
                    "CMD": "bitbake-layers show-recipes"
                }
            },
            "args": [
            ],
            "problemMatcher": [
                "$gcc"
            ],
            "icon": {
                "id": "flame",
                "color": "terminal.ansiYellow"
            },
            "dependsOrder": "sequence",
            "dependsOn": [
            ]
        },
        {
            "label": ".üìÉ Generate dependency info",
            "detail": "",
            "command": "${config:bitbake.setupScript}",
            "type": "shell",
            "options": {
                "cwd": "/workdir/torizon",
                "env": {
                    "EULA": "1",
                    "ACCEPT_FSL_EULA": "1",
                    "MACHINE": "${config:machine}",
                    "IMAGE": "${config:image}",
                    "BDDIR": "${config:build_dir}",
                    "CMD": "bitbake ${config:image} -g && code /workdir/torizon/build-torizon-upstream/task-depends.dot"
                }
            },
            "args": [
            ],
            "problemMatcher": [
                "$gcc"
            ],
            "icon": {
                "id": "flame",
                "color": "terminal.ansiYellow"
            },
            "dependsOrder": "sequence",
            "dependsOn": [
            ]
        },
        {
            "label": ".üìÉ Environment variables info",
            "detail": "",
            "command": "${config:bitbake.setupScript}",
            "type": "shell",
            "options": {
                "cwd": "/workdir/torizon/build-torizon-upstream",
                "env": {
                    "EULA": "1",
                    "ACCEPT_FSL_EULA": "1",
                    "MACHINE": "${config:machine}",
                    "IMAGE": "${config:image}",
                    "BDDIR": "${config:build_dir}",
                    "CMD": "bitbake ${config:image} -e > envs.sh && code /workdir/torizon/build-torizon-upstream/envs.sh"
                }
            },
            "args": [
            ],
            "problemMatcher": [
                "$gcc"
            ],
            "icon": {
                "id": "flame",
                "color": "terminal.ansiYellow"
            },
            "dependsOrder": "sequence",
            "dependsOn": [
            ]
        },
        {
            "label": "create-raspberrypi-os-list-json",
            "detail": "",
            "command": "pwsh",
            "type": "shell",
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "args": [
                "-nop",
                "-f",
                "${workspaceFolder}/.scripts/rpiImaginUtility.ps1",
            ],
            "problemMatcher": [
                "$gcc"
            ],
            "icon": {
                "id": "flame",
                "color": "terminal.ansiYellow"
            },
            "dependsOrder": "sequence",
            "dependsOn": [
            ]
        },
        {
            "label": "bitbake-clean-torizonCore",
            "detail": "",
            "command": "docker",
            "type": "shell",
            "options": {
                "cwd": "${workspaceFolder}/../workdir/torizon"
            },
            "args": [
                "run",
                "--rm",
                "-it",
                "--name=labs-crops",
                "-v",
                "${workspaceFolder}/../workdir:/workdir",
                "--workdir=/workdir",
                "-e",
                "EULA=1",
                "-e",
                "MACHINE=${config:machine}",
                "-e",
                "IMAGE=${config:image}",
                "-e",
                "CMD=\"bitbake -c cleanall torizon-core-docker\"",
                "matheuscastello/crops:kirkstone"
            ],
            "problemMatcher": [
                "$gcc"
            ],
            "icon": {
                "id": "flame",
                "color": "terminal.ansiYellow"
            },
            "dependsOrder": "sequence",
            "dependsOn": [
            ]
        },
        {
            "label": "bitbake-clean-torizonCore-container",
            "detail": "",
            "command": "${config:bitbake.setupScript}",
            "type": "shell",
            "options": {
                "cwd": "/workdir/torizon",
                "env": {
                    "EULA": "1",
                    "ACCEPT_FSL_EULA": "1",
                    "MACHINE": "${config:machine}",
                    "IMAGE": "${config:image}",
                    "DISTRO": "${config:distro}",
                    "CMD": "bitbake -c cleanall ${config:image}"
                }
            },
            "args": [
                "${config:build_dir}"
            ],
            "problemMatcher": [
                "$gcc"
            ],
            "icon": {
                "id": "flame",
                "color": "terminal.ansiYellow"
            },
            "dependsOrder": "sequence",
            "dependsOn": [
            ]
        },
        {
            "label": "bitbake-cleansstate-torizonCore",
            "detail": "",
            "command": "docker",
            "type": "shell",
            "options": {
                "cwd": "${workspaceFolder}/../workdir/torizon"
            },
            "args": [
                "run",
                "--rm",
                "-it",
                "--name=labs-crops",
                "-v",
                "${workspaceFolder}/../workdir:/workdir",
                "--workdir=/workdir",
                "-e",
                "ACCEPT_FSL_EULA=1",
                "-e",
                "MACHINE=${config:machine}",
                "-e",
                "IMAGE=${config:image}",
                "-e",
                "CMD=\"bitbake -c cleansstate torizon-core-docker\"",
                "matheuscastello/crops:kirkstone"
            ],
            "problemMatcher": [
                "$gcc"
            ],
            "icon": {
                "id": "flame",
                "color": "terminal.ansiYellow"
            },
            "dependsOrder": "sequence",
            "dependsOn": [
            ]
        },
        {
            "label": "bitbake-cleansstate-torizonCore-container",
            "detail": "",
            "command": "${config:bitbake.setupScript}",
            "type": "shell",
            "options": {
                "cwd": "/workdir/torizon",
                "env": {
                    "EULA": "1",
                    "ACCEPT_FSL_EULA": "1",
                    "MACHINE": "${config:machine}",
                    "IMAGE": "${config:image}",
                    "DISTRO": "${config:distro}",
                    "CMD": "bitbake world -c cleansstate --continue"
                }
            },
            "args": [
                "${config:build_dir}"
            ],
            "problemMatcher": [
                "$gcc"
            ],
            "icon": {
                "id": "flame",
                "color": "terminal.ansiYellow"
            },
            "dependsOrder": "sequence",
            "dependsOn": [
            ]
        },
        {
            "label": "crops-bash",
            "detail": "",
            "command": "docker",
            "type": "shell",
            "options": {
                "cwd": "${workspaceFolder}/../workdir/torizon"
            },
            "args": [
                "run",
                "--rm",
                "-it",
                "--name=labs-crops",
                "-v",
                "${workspaceFolder}/../workdir:/workdir",
                "--workdir=/workdir",
                "-e",
                "ACCEPT_FSL_EULA=1",
                "-e",
                "MACHINE=${config:machine}",
                "matheuscastello/crops:kirkstone"
            ],
            "problemMatcher": [
                "$gcc"
            ],
            "icon": {
                "id": "flame",
                "color": "terminal.ansiYellow"
            },
            "dependsOrder": "sequence",
            "dependsOn": [
            ]
        },
        {
            "label": "crops-bash-container",
            "detail": "",
            "command": "${config:bitbake.setupScript}",
            "type": "shell",
            "options": {
                "cwd": "/workdir/torizon",
                "env": {
                    "EULA": "1",
                    "ACCEPT_FSL_EULA": "1",
                    "MACHINE": "${config:machine}",
                    "IMAGE": ""
                }
            },
            "args": [
            ],
            "problemMatcher": [
                "$gcc"
            ],
            "icon": {
                "id": "flame",
                "color": "terminal.ansiYellow"
            },
            "dependsOrder": "sequence",
            "dependsOn": [
            ]
        },
        {
            "label": ".üìÇ Open Layers Workspace",
            "detail": "",
            "command": "code",
            "type": "shell",
            "presentation": {
                "echo": true,
                "reveal": "never",
                "focus": false,
                "panel": "shared",
                "showReuseMessage": false,
                "clear": false
            },
            "args": [
                "/workdir/torizon/layers"
            ],
            "problemMatcher": [
                "$gcc"
            ],
            "icon": {
                "id": "flame",
                "color": "terminal.ansiYellow"
            },
            "dependsOrder": "sequence",
            "dependsOn": [
                "config-vscode-bitbake"
            ]
        },
        {
            "label": ".üìÇ Open Kernel Workspace",
            "detail": "",
            "command": "code",
            "type": "shell",
            "presentation": {
                "echo": true,
                "reveal": "never",
                "focus": false,
                "panel": "shared",
                "showReuseMessage": false,
                "clear": false
            },
            "args": [
                "/workdir/torizon/${config:build_dir}/tmp/work-shared/${config:machine}/kernel-source"
            ],
            "problemMatcher": [
                "$gcc"
            ],
            "icon": {
                "id": "flame",
                "color": "terminal.ansiYellow"
            },
            "dependsOrder": "sequence",
            "dependsOn": [
            ]
        },
        {
            "label": ".üìÇ Open U-Boot Workspace",
            "detail": "",
            "command": "code",
            "type": "shell",
            "presentation": {
                "echo": true,
                "reveal": "never",
                "focus": false,
                "panel": "shared",
                "showReuseMessage": false,
                "clear": false
            },
            "args": [
                "/sourcecode/u-boot"
            ],
            "problemMatcher": [
                "$gcc"
            ],
            "icon": {
                "id": "flame",
                "color": "terminal.ansiYellow"
            },
            "dependsOrder": "sequence",
            "dependsOn": [
            ]
        },
        {
            "label": "choose-machine",
            "detail": "hide",
            "command": "pwsh",
            "type": "shell",
            "args": [
                "-c",
                "./.scripts/machines.ps1 ${input:machine} ${input:image}"
            ],
            "dependsOrder": "sequence",
            "dependsOn": [
            ]
        },
        {
            "label": "choose-image",
            "detail": "hide",
            "command": "pwsh",
            "type": "shell",
            "args": [
                "-c",
                "./.scripts/images.ps1 ${input:image}"
            ],
            "dependsOrder": "sequence",
            "dependsOn": [
            ]
        },
        {
            "label": ".üõ†Ô∏è Configure Machine and Image",
            "detail": "",
            "command": "echo",
            "type": "shell",
            "args": [
                "setting up build for ${input:machine}"
            ],
            "dependsOrder": "sequence",
            "dependsOn": [
                "choose-machine",
                "choose-image"
            ]
        },
        {
            "label": "configure-build",
            "detail": "",
            "command": "echo",
            "type": "shell",
            "args": [
                "setting up build for ${input:machine}"
            ],
            "dependsOrder": "sequence",
            "dependsOn": [
                "choose-machine"
            ]
        },
        {
            "label": "recompile-kernel",
            "detail": "",
            "command": "${config:bitbake.setupScript}",
            "type": "shell",
            "options": {
                "cwd": "/workdir/torizon",
                "env": {
                    "EULA": "1",
                    "ACCEPT_FSL_EULA": "1",
                    "MACHINE": "${config:machine}",
                    "IMAGE": "${config:image}",
                    "DISTRO": "${config:distro}",
                    "CMD": "bitbake virtual/kernel -f -c compile"
                }
            },
            "args": [
                "${config:build_dir}"
            ],
            "problemMatcher": [
                "$gcc"
            ],
            "icon": {
                "id": "flame",
                "color": "terminal.ansiYellow"
            },
            "dependsOrder": "sequence",
            "dependsOn": [
            ]
        }
    ],
    "inputs": [
        {
            "id": "machine",
            "type": "pickString",
            "description": "Machine",
            "default": "raspberrypi4-64",
            "options": [
                "raspberrypi4-64",
                "raspberrypi3-64",
                "verdin-imx8mm",
                "apalis-imx8",
                "nezha-allwinner-d1",
                "intel-corei7-64",
                "beaglebone-yocto",
                "beagleplay",
                "raspberrypi0-2w-64",
            ]
        },
        {
            "id": "image",
            "type": "pickString",
            "description": "Image to build",
            "default": "torizon-core-common-docker",
            "options": [
                "torizon-core-common-docker",
                "torizon-core-common-docker-dev"
            ]
        },
        {
            "id": "variableName",
            "description": "Variable Name",
            "type": "promptString"
        },
        {
            "id": "recipeName",
            "description": "Recipe Name",
            "type": "promptString"
        }
    ]
}
